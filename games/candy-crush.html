<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>糖果消除 | 免下载休闲游戏平台</title>
    <link rel="canonical" href="https://nodownloadgames.click/games/candy-crush.html" />
    <meta name="description" content="在线玩糖果消除游戏，无需下载！交换相邻的糖果，匹配三个或更多相同颜色的糖果来消除它们。完全免费，直接在浏览器中玩！">
    <style>
        :root {
            --apple-blue: #007AFF;
            --apple-green: #34C759;
            --apple-pink: #FF2D55;
            --apple-purple: #AF52DE;
            --apple-yellow: #FFCC00;
            --apple-gray: #8E8E93;
            --apple-light-gray: #F2F2F7;
            --apple-dark-gray: #1C1C1E;
            --page-padding: max(5vw, 1rem);
            
            /* 糖果颜色 */
            --candy-red: #FF3B30;
            --candy-orange: #FF9500;
            --candy-yellow: #FFCC00;
            --candy-green: #34C759;
            --candy-blue: #5AC8FA;
            --candy-purple: #AF52DE;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: var(--apple-light-gray);
            color: var(--apple-dark-gray);
            line-height: 1.6;
        }
        
        header {
            background-color: var(--apple-blue);
            color: white;
            padding: 1rem var(--page-padding);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        
        nav a:hover {
            text-decoration: underline;
        }
        
        .game-container {
            padding: 2rem var(--page-padding);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--apple-dark-gray);
        }
        
        .game-description {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 2rem;
            color: var(--apple-gray);
        }
        
        .game-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .candy-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-bottom: 1.5rem;
        }
        
        .score-box, .moves-box {
            background-color: var(--apple-dark-gray);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            text-align: center;
            flex: 1;
            margin: 0 0.5rem;
        }
        
        .score-label, .moves-label {
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        
        .score-value, .moves-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .game-board {
            background-color: #FAF8F0;
            border-radius: 6px;
            padding: 5px;
            position: relative;
            width: 400px;
            height: 400px;
            margin-bottom: 1.5rem;
            border: 3px solid var(--apple-dark-gray);
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 5px;
        }
        
        .candy {
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .candy.selected {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .candy.matched {
            animation: pop 0.3s;
        }
        
        @keyframes pop {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }
        
        .candy-red {
            background-color: var(--candy-red);
        }
        
        .candy-orange {
            background-color: var(--candy-orange);
        }
        
        .candy-yellow {
            background-color: var(--candy-yellow);
        }
        
        .candy-green {
            background-color: var(--candy-green);
        }
        
        .candy-blue {
            background-color: var(--candy-blue);
        }
        
        .candy-purple {
            background-color: var(--candy-purple);
        }
        
        .game-controls {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
        }
        
        .control-btn {
            background-color: var(--apple-blue);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 1rem;
        }
        
        .control-btn:hover {
            background-color: #0066CC;
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            display: none;
            border-radius: 10px;
        }
        
        .game-over h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--apple-dark-gray);
        }
        
        .game-over p {
            font-size: 1.5rem;
            color: var(--apple-gray);
            margin-bottom: 2rem;
        }
        
        #retry-btn {
            background-color: var(--apple-green);
        }
        
        .game-instructions {
            margin-top: 3rem;
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .instructions-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--apple-dark-gray);
        }
        
        .instructions-list {
            padding-left: 1.5rem;
        }
        
        .instructions-list li {
            margin-bottom: 0.8rem;
        }
        
        .level-box {
            background-color: var(--apple-pink);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 5px;
            display: inline-block;
            margin-bottom: 1.5rem;
        }
        
        .level-label {
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        
        .level-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        footer {
            background-color: var(--apple-dark-gray);
            color: white;
            padding: 2rem var(--page-padding);
            text-align: center;
            margin-top: 2rem;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
            font-size: 0.9rem;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        .copyright {
            font-size: 0.8rem;
            color: var(--apple-gray);
            margin-top: 1rem;
        }
        
        @media (max-width: 768px) {
            nav ul {
                display: none;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .game-board {
                width: 360px;
                height: 360px;
            }
        }
        
        @media (max-width: 480px) {
            .game-board {
                width: 290px;
                height: 290px;
                gap: 3px;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">NoDownloadGames</div>
            <ul>
                <li><a href="../index.html">首页</a></li>
                <li><a href="../index.html#popular">热门游戏</a></li>
                <li><a href="../index.html#categories">游戏分类</a></li>
                <li><a href="../index.html#about">关于我们</a></li>
            </ul>
        </nav>
    </header>
    
    <div class="game-container">
        <h1 class="game-title">糖果消除</h1>
        <p class="game-description">消除三个或更多相同颜色的糖果来获取积分！交换相邻的糖果，创建匹配的组合，完成关卡目标。</p>
        
        <div class="game-content">
            <div class="candy-container">
                <div class="level-box">
                    <div class="level-label">关卡</div>
                    <div id="level" class="level-value">1</div>
                </div>
                
                <div class="game-info">
                    <div class="score-box">
                        <div class="score-label">分数</div>
                        <div id="score" class="score-value">0</div>
                    </div>
                    <div class="moves-box">
                        <div class="moves-label">剩余步数</div>
                        <div id="moves" class="moves-value">20</div>
                    </div>
                </div>
                
                <div id="game-board" class="game-board">
                    <!-- 糖果将由JavaScript动态生成 -->
                </div>
                
                <div class="game-over" id="game-over">
                    <h2 id="game-result">游戏结束</h2>
                    <p>你的分数: <span id="final-score">0</span></p>
                    <button id="retry-btn" class="control-btn">再试一次</button>
                </div>
                
                <div class="game-controls">
                    <button id="new-game-btn" class="control-btn">新游戏</button>
                    <button id="hint-btn" class="control-btn">提示</button>
                </div>
            </div>
        </div>
        
        <div class="game-instructions">
            <h2 class="instructions-title">游戏规则</h2>
            <ul class="instructions-list">
                <li>点击一个糖果，然后点击相邻的糖果来交换它们的位置。</li>
                <li>只有在交换后能形成至少三个相同颜色的糖果连成一行或一列时，交换才有效。</li>
                <li>三个相同糖果可以得到基础分数，四个或更多可以获得额外分数奖励。</li>
                <li>每次有效移动会消耗一步。当没有剩余步数时，游戏结束。</li>
                <li>达到目标分数时，你将进入下一关卡，难度会逐渐增加。</li>
                <li>使用"提示"按钮可以帮助找到可以匹配的糖果，但会减少1步。</li>
                <li>尝试通过最少的步数达到最高分数！</li>
            </ul>
        </div>
    </div>
    
    <footer>
        <div class="footer-content">
            <div class="logo" style="margin-bottom: 1rem;">NoDownloadGames</div>
            <div class="footer-links">
                <a href="../index.html">首页</a>
                <a href="../index.html#popular">热门游戏</a>
                <a href="../index.html#categories">游戏分类</a>
                <a href="../index.html#about">关于我们</a>
                <a href="../privacy.html">隐私政策</a>
                <a href="../terms.html">使用条款</a>
                <a href="../contact.html">联系我们</a>
            </div>
            <p class="copyright">© 2023 NoDownloadGames.click. 保留所有权利。</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 游戏配置
            const GRID_SIZE = 8;
            const CANDY_TYPES = 6; // 糖果种类数量
            const MATCH_MIN = 3; // 最小匹配数
            const ANIMATION_DURATION = 300; // 动画持续时间（毫秒）
            
            // 关卡配置
            const LEVEL_CONFIG = [
                { moves: 20, target: 1000 },
                { moves: 25, target: 2000 },
                { moves: 30, target: 3500 },
                { moves: 25, target: 5000 },
                { moves: 30, target: 7500 }
            ];
            
            // DOM元素
            const gameBoard = document.getElementById('game-board');
            const scoreElement = document.getElementById('score');
            const movesElement = document.getElementById('moves');
            const levelElement = document.getElementById('level');
            const gameOverScreen = document.getElementById('game-over');
            const gameResultElement = document.getElementById('game-result');
            const finalScoreElement = document.getElementById('final-score');
            const newGameButton = document.getElementById('new-game-btn');
            const hintButton = document.getElementById('hint-btn');
            const retryButton = document.getElementById('retry-btn');
            
            // 游戏状态
            let board = [];
            let selectedCandy = null;
            let score = 0;
            let moves = 0;
            let level = 1;
            let isSwapping = false;
            let isProcessingMatches = false;
            let hintTimeout = null;
            
            // 糖果颜色类
            const candyColors = [
                'candy-red',
                'candy-orange',
                'candy-yellow',
                'candy-green',
                'candy-blue',
                'candy-purple'
            ];
            
            // 初始化游戏
            function initGame() {
                // 清除提示定时器
                if (hintTimeout) {
                    clearTimeout(hintTimeout);
                    hintTimeout = null;
                }
                
                // 重置状态
                board = [];
                selectedCandy = null;
                score = 0;
                level = 1;
                moves = LEVEL_CONFIG[level - 1].moves;
                isSwapping = false;
                isProcessingMatches = false;
                
                // 更新显示
                scoreElement.textContent = score;
                movesElement.textContent = moves;
                levelElement.textContent = level;
                
                // 隐藏游戏结束屏幕
                gameOverScreen.style.display = 'none';
                
                // 创建初始游戏板
                createBoard();
                
                // 检查并消除初始匹配项
                checkAndClearMatches();
            }
            
            // 创建游戏板
            function createBoard() {
                // 清空游戏板
                gameBoard.innerHTML = '';
                
                // 初始化二维数组
                for (let i = 0; i < GRID_SIZE; i++) {
                    board[i] = [];
                    for (let j = 0; j < GRID_SIZE; j++) {
                        // 随机生成糖果，但避免在初始状态就有匹配
                        let candyType;
                        do {
                            candyType = Math.floor(Math.random() * CANDY_TYPES);
                        } while (
                            // 检查水平方向
                            (j >= 2 && board[i][j-1] === candyType && board[i][j-2] === candyType) ||
                            // 检查垂直方向
                            (i >= 2 && board[i-1][j] === candyType && board[i-2][j] === candyType)
                        );
                        
                        board[i][j] = candyType;
                        
                        // 创建糖果元素
                        const candy = document.createElement('div');
                        candy.className = `candy ${candyColors[candyType]}`;
                        candy.dataset.row = i;
                        candy.dataset.col = j;
                        
                        // 添加点击事件
                        candy.addEventListener('click', () => candyClick(i, j));
                        
                        // 将糖果添加到游戏板
                        gameBoard.appendChild(candy);
                    }
                }
            }
            
            // 糖果点击处理
            function candyClick(row, col) {
                // 如果正在处理动画或比赛，忽略点击
                if (isSwapping || isProcessingMatches) return;
                
                // 获取被点击的糖果元素
                const clickedCandy = document.querySelector(`.candy[data-row="${row}"][data-col="${col}"]`);
                
                // 如果没有选中的糖果，选中当前糖果
                if (!selectedCandy) {
                    selectedCandy = { row, col, element: clickedCandy };
                    clickedCandy.classList.add('selected');
                } else {
                    // 如果已经有选中的糖果
                    
                    // 如果点击的是同一个糖果，取消选择
                    if (selectedCandy.row === row && selectedCandy.col === col) {
                        selectedCandy.element.classList.remove('selected');
                        selectedCandy = null;
                        return;
                    }
                    
                    // 检查是否相邻
                    const isAdjacent = 
                        (Math.abs(selectedCandy.row - row) === 1 && selectedCandy.col === col) ||
                        (Math.abs(selectedCandy.col - col) === 1 && selectedCandy.row === row);
                    
                    if (isAdjacent) {
                        // 移除选中状态
                        selectedCandy.element.classList.remove('selected');
                        
                        // 尝试交换糖果
                        swapCandies(selectedCandy.row, selectedCandy.col, row, col);
                        
                        // 重置选中糖果
                        selectedCandy = null;
                    } else {
                        // 如果不相邻，选中新的糖果
                        selectedCandy.element.classList.remove('selected');
                        selectedCandy = { row, col, element: clickedCandy };
                        clickedCandy.classList.add('selected');
                    }
                }
            }
            
            // 交换糖果
            function swapCandies(row1, col1, row2, col2) {
                isSwapping = true;
                
                // 获取两个糖果元素
                const candy1 = document.querySelector(`.candy[data-row="${row1}"][data-col="${col1}"]`);
                const candy2 = document.querySelector(`.candy[data-row="${row2}"][data-col="${col2}"]`);
                
                // 更新数据属性
                candy1.dataset.row = row2;
                candy1.dataset.col = col2;
                candy2.dataset.row = row1;
                candy2.dataset.col = col1;
                
                // 交换数组中的值
                const temp = board[row1][col1];
                board[row1][col1] = board[row2][col2];
                board[row2][col2] = temp;
                
                // 检查是否有匹配
                const hasMatches = checkForMatches();
                
                if (hasMatches) {
                    // 如果有匹配，减少步数并处理匹配
                    moves--;
                    movesElement.textContent = moves;
                    
                    // 处理匹配项
                    setTimeout(() => {
                        checkAndClearMatches();
                        isSwapping = false;
                        
                        // 检查游戏状态
                        checkGameStatus();
                    }, ANIMATION_DURATION);
                } else {
                    // 如果没有匹配，还原交换
                    setTimeout(() => {
                        // 还原数据属性
                        candy1.dataset.row = row1;
                        candy1.dataset.col = col1;
                        candy2.dataset.row = row2;
                        candy2.dataset.col = col2;
                        
                        // 还原数组中的值
                        board[row2][col2] = board[row1][col1];
                        board[row1][col1] = temp;
                        
                        isSwapping = false;
                    }, ANIMATION_DURATION);
                }
            }
            
            // 检查是否有匹配
            function checkForMatches() {
                // 检查水平匹配
                for (let i = 0; i < GRID_SIZE; i++) {
                    for (let j = 0; j <= GRID_SIZE - MATCH_MIN; j++) {
                        const candyType = board[i][j];
                        let matchLength = 1;
                        
                        for (let k = 1; j + k < GRID_SIZE; k++) {
                            if (board[i][j + k] === candyType) {
                                matchLength++;
                            } else {
                                break;
                            }
                        }
                        
                        if (matchLength >= MATCH_MIN) {
                            return true;
                        }
                    }
                }
                
                // 检查垂直匹配
                for (let j = 0; j < GRID_SIZE; j++) {
                    for (let i = 0; i <= GRID_SIZE - MATCH_MIN; i++) {
                        const candyType = board[i][j];
                        let matchLength = 1;
                        
                        for (let k = 1; i + k < GRID_SIZE; k++) {
                            if (board[i + k][j] === candyType) {
                                matchLength++;
                            } else {
                                break;
                            }
                        }
                        
                        if (matchLength >= MATCH_MIN) {
                            return true;
                        }
                    }
                }
                
                return false;
            }
            
            // 检查并清除匹配项
            function checkAndClearMatches() {
                isProcessingMatches = true;
                
                // 标记要清除的糖果
                const matchesToClear = findMatches();
                
                // 如果没有匹配，结束处理
                if (matchesToClear.length === 0) {
                    isProcessingMatches = false;
                    return;
                }
                
                // 计算分数并清除匹配项
                let matchScore = 0;
                matchesToClear.forEach(match => {
                    const { row, col } = match;
                    const candy = document.querySelector(`.candy[data-row="${row}"][data-col="${col}"]`);
                    
                    // 为匹配的糖果添加消除动画
                    candy.classList.add('matched');
                    
                    // 每个匹配的糖果得10分
                    matchScore += 10;
                    
                    // 标记为要清除的
                    board[row][col] = -1;
                });
                
                // 更新分数
                score += matchScore;
                scoreElement.textContent = score;
                
                // 延迟后移除匹配项并填充新糖果
                setTimeout(() => {
                    // 移除动画类
                    matchesToClear.forEach(match => {
                        const { row, col } = match;
                        const candy = document.querySelector(`.candy[data-row="${row}"][data-col="${col}"]`);
                        candy.classList.remove('matched');
                    });
                    
                    // 移动糖果并填充新糖果
                    fillBoard();
                    
                    // 检查是否有新的匹配
                    setTimeout(() => {
                        // 递归检查新的匹配
                        const newMatches = findMatches();
                        if (newMatches.length > 0) {
                            checkAndClearMatches();
                        } else {
                            isProcessingMatches = false;
                        }
                    }, ANIMATION_DURATION);
                }, ANIMATION_DURATION);
            }
            
            // 查找所有匹配项
            function findMatches() {
                const matches = [];
                
                // 检查水平匹配
                for (let i = 0; i < GRID_SIZE; i++) {
                    for (let j = 0; j < GRID_SIZE; j++) {
                        const candyType = board[i][j];
                        if (candyType < 0) continue; // 跳过已标记为清除的
                        
                        // 检查右侧是否有连续匹配
                        let matchLength = 1;
                        for (let k = 1; j + k < GRID_SIZE; k++) {
                            if (board[i][j + k] === candyType) {
                                matchLength++;
                            } else {
                                break;
                            }
                        }
                        
                        // 如果匹配数量达到要求，标记所有匹配的糖果
                        if (matchLength >= MATCH_MIN) {
                            for (let k = 0; k < matchLength; k++) {
                                matches.push({ row: i, col: j + k });
                            }
                        }
                    }
                }
                
                // 检查垂直匹配
                for (let j = 0; j < GRID_SIZE; j++) {
                    for (let i = 0; i < GRID_SIZE; i++) {
                        const candyType = board[i][j];
                        if (candyType < 0) continue; // 跳过已标记为清除的
                        
                        // 检查下方是否有连续匹配
                        let matchLength = 1;
                        for (let k = 1; i + k < GRID_SIZE; k++) {
                            if (board[i + k][j] === candyType) {
                                matchLength++;
                            } else {
                                break;
                            }
                        }
                        
                        // 如果匹配数量达到要求，标记所有匹配的糖果
                        if (matchLength >= MATCH_MIN) {
                            for (let k = 0; k < matchLength; k++) {
                                matches.push({ row: i + k, col: j });
                            }
                        }
                    }
                }
                
                // 去重（可能有交叉匹配的糖果）
                return Array.from(new Set(matches.map(m => `${m.row}-${m.col}`)))
                    .map(id => {
                        const [row, col] = id.split('-').map(Number);
                        return { row, col };
                    });
            }
            
            // 填充游戏板
            function fillBoard() {
                // 从下到上检查每一列
                for (let j = 0; j < GRID_SIZE; j++) {
                    // 计算每列空缺的位置数
                    let emptyCount = 0;
                    
                    // 从下到上移动糖果
                    for (let i = GRID_SIZE - 1; i >= 0; i--) {
                        if (board[i][j] === -1) {
                            emptyCount++;
                        } else if (emptyCount > 0) {
                            // 将糖果下移
                            const newRow = i + emptyCount;
                            board[newRow][j] = board[i][j];
                            board[i][j] = -1;
                            
                            // 更新DOM
                            const candy = document.querySelector(`.candy[data-row="${i}"][data-col="${j}"]`);
                            candy.dataset.row = newRow;
                        }
                    }
                    
                    // 填充顶部的空缺
                    for (let i = 0; i < emptyCount; i++) {
                        const randCandyType = Math.floor(Math.random() * CANDY_TYPES);
                        board[i][j] = randCandyType;
                        
                        // 找到一个标记为-1的元素并重用它
                        const candy = document.querySelector(`.candy[data-row="-1"][data-col="${j}"]`);
                        if (candy) {
                            // 更新类和属性
                            candy.className = `candy ${candyColors[randCandyType]}`;
                            candy.dataset.row = i;
                        } else {
                            // 如果没有找到，创建新的（理论上不应该发生）
                            const newCandy = document.createElement('div');
                            newCandy.className = `candy ${candyColors[randCandyType]}`;
                            newCandy.dataset.row = i;
                            newCandy.dataset.col = j;
                            newCandy.addEventListener('click', () => candyClick(i, j));
                            gameBoard.appendChild(newCandy);
                        }
                    }
                }
            }
            
            // 检查可能的移动
            function findPossibleMoves() {
                const possibleMoves = [];
                
                // 水平检查
                for (let i = 0; i < GRID_SIZE; i++) {
                    for (let j = 0; j < GRID_SIZE - 1; j++) {
                        // 临时交换
                        const temp = board[i][j];
                        board[i][j] = board[i][j + 1];
                        board[i][j + 1] = temp;
                        
                        // 检查是否有匹配
                        if (checkForMatches()) {
                            possibleMoves.push({ row1: i, col1: j, row2: i, col2: j + 1 });
                        }
                        
                        // 还原交换
                        board[i][j + 1] = board[i][j];
                        board[i][j] = temp;
                    }
                }
                
                // 垂直检查
                for (let i = 0; i < GRID_SIZE - 1; i++) {
                    for (let j = 0; j < GRID_SIZE; j++) {
                        // 临时交换
                        const temp = board[i][j];
                        board[i][j] = board[i + 1][j];
                        board[i + 1][j] = temp;
                        
                        // 检查是否有匹配
                        if (checkForMatches()) {
                            possibleMoves.push({ row1: i, col1: j, row2: i + 1, col2: j });
                        }
                        
                        // 还原交换
                        board[i + 1][j] = board[i][j];
                        board[i][j] = temp;
                    }
                }
                
                return possibleMoves;
            }
            
            // 显示提示
            function showHint() {
                // 如果游戏结束或正在处理匹配，不显示提示
                if (moves <= 0 || isProcessingMatches || isSwapping) return;
                
                // 扣除一步
                moves--;
                movesElement.textContent = moves;
                
                // 找出可能的移动
                const possibleMoves = findPossibleMoves();
                
                if (possibleMoves.length > 0) {
                    // 随机选择一个可能的移动
                    const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    const { row1, col1, row2, col2 } = randomMove;
                    
                    // 获取相应的糖果元素
                    const candy1 = document.querySelector(`.candy[data-row="${row1}"][data-col="${col1}"]`);
                    const candy2 = document.querySelector(`.candy[data-row="${row2}"][data-col="${col2}"]`);
                    
                    // 添加闪烁效果
                    const highlightClass = 'selected';
                    
                    function toggleHighlight() {
                        candy1.classList.toggle(highlightClass);
                        candy2.classList.toggle(highlightClass);
                    }
                    
                    // 闪烁3次
                    toggleHighlight();
                    
                    // 设置三次闪烁的定时器
                    let flashCount = 0;
                    hintTimeout = setInterval(() => {
                        toggleHighlight();
                        flashCount++;
                        
                        if (flashCount >= 5) {
                            clearInterval(hintTimeout);
                            hintTimeout = null;
                            
                            // 确保最后状态是不高亮
                            candy1.classList.remove(highlightClass);
                            candy2.classList.remove(highlightClass);
                        }
                    }, 300);
                }
                
                // 检查游戏状态
                checkGameStatus();
            }
            
            // 检查游戏状态
            function checkGameStatus() {
                // 如果没有剩余步数，游戏结束
                if (moves <= 0) {
                    // 检查是否达到目标分数
                    const currentLevelConfig = LEVEL_CONFIG[level - 1];
                    
                    if (score >= currentLevelConfig.target) {
                        // 过关，进入下一关
                        if (level < LEVEL_CONFIG.length) {
                            level++;
                            moves = LEVEL_CONFIG[level - 1].moves;
                            
                            // 更新显示
                            levelElement.textContent = level;
                            movesElement.textContent = moves;
                            
                            // 显示过关消息
                            gameResultElement.textContent = "恭喜过关！";
                            finalScoreElement.textContent = score;
                            gameOverScreen.style.display = 'flex';
                            
                            // 3秒后自动隐藏
                            setTimeout(() => {
                                gameOverScreen.style.display = 'none';
                            }, 3000);
                        } else {
                            // 通关所有关卡
                            endGame(true);
                        }
                    } else {
                        // 未达到目标，游戏失败
                        endGame(false);
                    }
                }
            }
            
            // 结束游戏
            function endGame(isWin) {
                // 显示结果
                gameResultElement.textContent = isWin ? "恭喜通关！" : "游戏结束";
                finalScoreElement.textContent = score;
                gameOverScreen.style.display = 'flex';
            }
            
            // 添加事件监听器
            newGameButton.addEventListener('click', initGame);
            hintButton.addEventListener('click', showHint);
            retryButton.addEventListener('click', initGame);
            
            // 初始化游戏
            initGame();
        });
    </script>
</body>
</html> 